# Algebraic Modeling Language Benchmarks

Three different algebraic modeling languages AMPL, GAMS and Pyomo were benchmarked. The base of the benchmark was problems available in GAMS Model library converted to scalar models in each of the analyzed modeling languages.

Two types of benchmarks were conducted:

1. Model instance creation time benchmark - to measure how long it take to load a model instance in a specific algebraic modeling language.
2. AMPL presolver benchmark - to analyze the efficient of AMPL presolver.

## Model Instance Creation Time Benchmark

### Benchmark Methodology

1. Load model instance of a problem written in the native algebraic modeling language (_AMPL, GAMS, Pyomo_) of the modeling system.
2. Export loaded model instance to the solver compatible input format. [NL](https://en.wikipedia.org/wiki/Nl_(format)) or NLC formats are used.
3. Measure total (loading and exporting) execution time.

### Issues Found

- **12** AMPL models generated by GAMS Convert command were invalid, thus loading of them as AMPL model instances failed.
- **29** Pyomo models generated by GAMS Convert command were invalid, thus loading of them as Pyomo model instances failed.

### Results

Detailed benchmark results for each of the models can be found [here](model-loading-times.md).

**Average loading times by model problem type in milliseconds**: 

| Type      | Models  | AMPL   | GAMS    | Pyomo   |
| --------- | ------- | ------ | ------- | ------- |
| CNS       | 4       | 15     | 234     | 838     |
| DNLP      | 5       | 10     | 227     | 719     |
| LP        | 57      | 19     | 240     | 841     |
| MCP       | 13      | 14     | 234     | 764     |
| MINLP     | 17      | 11     | 242     | 745     |
| MIP       | 57      | 22     | 259     | 936     |
| MIQCP     | 4       | 11     | 238     | 852     |
| MPEC      | 1       | 10     | 236     | 669     |
| NLP       | 101     | 20     | 262     | 826     |
| QCP       | 10      | 51     | 364     | 1344    |
| **Total** | **269** | **20** | **256** | **862** |

> Note: averages were calculated only for models which were successfully loaded by all modeling systems.

## Presolve Benchmark

AMPL is the only of the benchmarked modeling language capable of performing model presolving before calling the solver. GAMS and Pyomo are only capable of using presolving functionality provided by the solvers themselves.

### Presolve Usage

Full AMPL presolve usage statistics can be found [here](ampl-presolve-stats.md).

AMPL presolver simplified model instances in **52.8%** of the cases, out of which:

* determined 5 models to be not feasible
* on avarage eliminated **18.42%** of constraints and **10.73%** of variables

**AMPL Presolver characteristics by model problem type**: 

| Type      | Models  | Presolved | Presolved (%) | Not Feasible | Constrains reduced | Variables reduced |
| --------- | ------- | --------- | ------------- | ------------ | ------------------ | ----------------- |
| CNS       | 4       | 4         | 100.00%       | 0            | 14.63%             | 31.39%            |
| DNLP      | 5       | 1         | 20.00%        | 0            | 0.00%              | 7.41%             |
| LP        | 57      | 21        | 36.84%        | 0            | 17.81%             | 9.66%             |
| MCP       | 19      | 17        | 89.47%        | 0            | 47.00%             | 8.56%             |
| MINLP     | 21      | 13        | 61.90%        | 1            | 16.32%             | 9.30%             |
| MIP       | 61      | 37        | 60.66%        | 0            | 19.06%             | 11.50%            |
| MIQCP     | 5       | 3         | 60.00%        | 2            | 0.00%              | 2.38%             |
| MPEC      | 1       | 1         | 100.00%       | 0            | 50.00%             | 0.00%             |
| NLP       | 101     | 48        | 47.52%        | 2            | 9.71%              | 11.55%            |
| QCP       | 10      | 6         | 60.00%        | 0            | 7.10%              | 2.55%             |
| RMIQCP    | 2       | 0         | 0.00%         | 0            | 0.00%              | 0.00%             |
| **Total** | **286** | **151**   | **52.80%**    | **5**        | **18.42%**         | **10.73%**        |

### Presolve impact on solving

In order to evaluate if AMPL presolving has a positive impact on problem solving an additional benchmark was conducted. 

The benchmark included 146 out of 151 models to which AMPL has applied presolve in the model loading benchmark. 5 models which AMPL presolve determined to be not feasible were excluded from the benchmark. 

Two attempts to solve each model were made. One with AMPL presolver turned on (default setting) and second one with AMPL presolver turned off. After each run solvers statistics including iterations count, solve time (pure solve time) and obective were gathered (MCP, CNS problems do not have objective function). 

Models were solved using Gurobi and BARON solvers:

* Gurobi Optimizer was chosen for solving LP, MIP, QCP and MIQCP type of problems
* Baron global optimality solver was chosen for solving NLP, MINLP, MCP, MPEC, CNS and DNLP problems

> CPU running time of Baron solver was constrained to 500 seconds

Solver iterations were counted in the following manner:

* for LP problems simplex iterations were counted
* for MIP problems exploration and intbasis simplex iterations were counted
* for QP barrier iterations were counted
* for all problems solved using BARON solver node iterations were counted (BARON does not expose local solver's iterations count)

#### Benchmark results

1. **6 models** failed to be solved due to solver limitations:
   1. `himmel11`, `tricp` (QCP) problems failed to be solved due to Gurobi not being capable to handle quadratic equality constraints
   2. `lnts`, `polygon` (NLP) problems used *cos* and *sin* operations not supported by BARON solver
   3. `maxmin` (DNLP) failed to be solved since BARON cannot handle discontinuities
   4. `traffic` (MCP) problem was too compelex for BARON to handle in given CPU time
2. **2 models** (dispatch, meanvarm) deemed to be infeasible
3. **2 models** (hhmax, lrs) were solved during AMPL presolve phase 
4. For **2 models** (hhfair, nash) optimal solution was indicated with a likelyhood of error due to numeric difficulties
5. **41 models** were solved during solver's presolve phase
6. For **6 models** mismatching objective was found with presolve turned on and off (mostly caused by the CPU time limitation imposed to the BARON solver)
7. AMPL presolve had a positive impact in **26.43%** of cases iteration wise and **47.86%** time wise. However it had a negative impact in **20.71%** iteration wise and **23.57%** time wise.

**Summary of presolve impact**

|            | Iterations wise | Time wise | Iterations wise % | Time wise % |
|------------|------|--------------|--------|--------|
| Positive   | 37   | 67           | 26.43% | 47.86% |
| Neutral   | 74   | 40           | 52.86% | 28.57% |
| Negative   | 29   | 33           | 20.71% | 23.57% |

> Table above summarizes the positive and negative impact AMPL presolve had on solving problems iteration and time wise

Detailed AMPL presolve impact on solving can be found in [ampl-solving-times.md](ampl-solving-times.md) and [ampl-solving-times.xlsx](ampl-solving-times.xlsx) reports.