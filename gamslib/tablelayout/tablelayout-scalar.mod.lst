GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:43:40 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1  option MIP=convert;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:43:40 Page 2
Configuring text layout in table cells to minimize table height (TABLELAYOUT,SEQ=402)
C o m p i l a t i o n


      The Automated Table Layout problem is a document processing issue.
       
      Given a table with a number of rows and columns, into each cell you have to place some text.
      For each cell, a number of configurations on how to break the text into several lines is given,
      therefore it generates various rectangles of different width and height.
      Thus, each configuration yields different requirements on the height and width of the cell,
      and therefor on the height of the row and the width of the column that the cell belongs to.
      The column width needs to be the same for all cells in that column, thus it is given by the
      maximum width of the chosen configurations over all cells in that column. The same for the rows.
      Given the width of the page, the objective is to find a layout minimizing the total height of the table.
       
      For more details, see
        Mihai Bilauca and Patrick Healy (2010).
        A new model for automated table layout.
        Proceedings of the 10th ACM symposium on Document engineering, pp 169-176.
        http://dx.doi.org/10.1145/1860559.1860594
       
        Mihai Bilauca (2012).
        Automatic table layout and formatting.
        PhD Thesis, University of Limerick
        http://ulir.ul.ie/handle/10344/2834
       
       
      Below, we provide different formulations of the problem, names "cols", "rows", and "cp".
      The --formulation option can be used to select any of them. Default is "rows".
      - In the "cols" formulation, we let the solver pick a width for each column out of the possible widths
        that make sense for the column, i.e., the widths of all configurations in all cells of that column.
        Thus, there is a number of binary variables for each column, exactly one of them needs to be 1,
        to decide for the column width.
      - The "rows" formulation is similar, but picks a height for each row instead.
        By looking at the data, one recognizes that there are only about 6 different heights used by all configurations.
        So optimizing the task of picking a height for each row results in much less binary variables
        than picking a width for each column. (there are always as many columns as rows)
        Thus, this formulation is expected to be better than the "cols" one.
      - The "cp" formulation is a very straightforward one, where we have integer variables to decide for the
        width of each column and the height of each row, and a constraint that says that for each cell, there
        need to be at least one configuration that fits into the chosen column width and row height.
        This is formulated by equation 'cellconfig' below, which can only be handled by few solvers in GAMS.
        The model type for this model is MINLP.
       
      Finally, for the "cols" and "rows" formulation, we have two variants. In the MINLP variant, which can
      be enabled via option --useMINLP 1, we use an smax to define an intermediate variable, while in the
      default MIP variant this smax is linearized in the usual way (no additional variables but more equations needed).
       
       
      Further instances are available at http://www.localsolver.com/exampletour.html?file=table_layout.zip
      The provided tablelayout5x5.inc data file corresponds to their free_trial.in file.
  52   
  55   
  57   
  58  option optcr=0;
  59  option limcol=0;
  60  option limrow=0;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:43:40 Page 3
Configuring text layout in table cells to minimize table height (TABLELAYOUT,SEQ=402)
C o m p i l a t i o n


  61   
  62  * ===== Data Preparation =====
  63   
  81   
  85   
 103   
 104  Set  r              rows
 105       c              columns
 106       w              widths
 107       h              heights
 108       rcwh(r,c,w,h)  configuration data (width and heights in a cell)
 109  Parameter
 110       pw    page width
 111       nw(w) numerical width
 112       nh(h) numercial height
 113  ;
GDXIN   /home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/inst.gdx
--- LOAD  r = 1:r
--- LOAD  c = 2:c
--- LOAD  w = 3:w
--- LOAD  h = 4:h
--- LOAD  rcwh = 5:rcwh
--- LOAD  pw = 6:pw
--- LOAD  nw = 7:nw
--- LOAD  nh = 8:nh
 117   
 118  * ===== Goto Formulation =====
 119   
 122   
 123  Set  rh(r,h)              heights in a row;
 124  rh(r,h) = sum(rcwh(r,c,w,h), 1);
 125   
 126  Alias (h,hh);
 127   
 128  * if cell (r,c) takes height h, look for the smallest possible width that (r,c) would need
 129  * i.e., among all configurations with height <= h, pick the one with minimal width
 130  Parameter minRCHw(r,c,h) 'minimum possible width in cell (r,c) when row r takes height h';
 131  minRCHw(r,c,h)$rh(r,h) = smin(rcwh(r,c,w,hh)$(nh(hh)<=nh(h)), nw(w));
 132   
 133  * Remove row height that result in infeasible layout
 134  * I.e., if assigning a certain height to a row would mean that for certain cells in this
 135  * row there is no configuration that fits into this height (represented by an INF for the
 136  * above smin), then we can forbid this row to height assignment.
 137  rh(r,h)$sum(c$(minRCHw(r,c,h)=INF),1) = no;
 138   
 139  Variables
 140      bRH(r,h)    row r takes height h
 141      xRCw(r,c)   width of cell
 142      xCw(c)      width of column
 143      toth        total page height
 144  Binary variables bRH;
 145  Equation
 146      defbRH(r)      each row takes exactly one height
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:43:40 Page 4
Configuring text layout in table cells to minimize table height (TABLELAYOUT,SEQ=402)
C o m p i l a t i o n


 147      defxRCw(r,c)   define cell width
 148      defxCwMINLP(c) define column width
 149      defxCwMIP(r,c) define column width
 150      defpw          limit layout by page width
 151      deftoth        objective total height;
 152   
 153  defbRH(r)..      sum(rh(r,h), bRH(r,h)) =e= 1;
 154   
 155  * the width of cell (r,c) in case that row r chooses height h has been
 156  * precomputed above to be minRCHw(r,c,h), so here we just have to pick the right one
 157  defxRCw(r,c)..   xRCw(r,c) =e= sum(rh(r,h), bRH(r,h)*minRCHw(r,c,h));
 158   
 159  * the width of a column c is given by the maximum of the widths of the cells in column c
 160  defxCwMINLP(c).. xCw(c) =e= smax(r, xRCw(r,c));
 161  defxCwMIP(r,c).. xCw(c) =g= xRCw(r,c);
 162   
 163  defpw..          sum(c, xCW(c)) =l= pw;
 164   
 165  * the objective is to minimize the sum of the heights of all rows
 166  deftoth..        toth =e= sum(rh(r,h), bRH(r,h) * nh(h));
 167   
 168  model layoutMINLP / all - defxCwMIP   /
 169        layoutMIP   / all - defxCwMINLP /;
 170   
 171  option optcr=0;
 172   
 174  solve layoutMIP   using MIP   min toth;
 175   
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:43:40 Page 5
Configuring text layout in table cells to minimize table height (TABLELAYOUT,SEQ=402)
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  /home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/tablelayout.gms
     2       54 IF EXIST       1      54  /home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/tablelayout5x5.inc
     3       83 CALL           1      83  awk -f "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/tl.awk" tablelayout5x5.inc | uniq > "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/tlinst.dat"
     4      101 CALL           1     101  gams "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/dataprep" lo=2 o="/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/dataprep.lst"
     5      114 GDXIN          1     114  /home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/inst.gdx
     6      177 CALL           1     302  rm -f "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/inst.gdx" "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/dataprep.gms" "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/225a/datapr
                                          ep.lst" "/home/renigijus/gams/opt-mod-lib/


COMPILATION TIME     =        0.074 SECONDS      3 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:43:40 Page 6
Configuring text layout in table cells to minimize table height (TABLELAYOUT,SEQ=402)
Model Statistics    SOLVE layoutMIP Using MIP From line 174


MODEL STATISTICS

BLOCKS OF EQUATIONS           5     SINGLE EQUATIONS           57
BLOCKS OF VARIABLES           4     SINGLE VARIABLES           59
NON ZERO ELEMENTS           277     DISCRETE VARIABLES         28


GENERATION TIME      =        0.002 SECONDS      4 MB  24.7.4 r58773 LEX-LEG


EXECUTION TIME       =        0.003 SECONDS      4 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:43:40 Page 7
Configuring text layout in table cells to minimize table height (TABLELAYOUT,SEQ=402)
Solution Report     SOLVE layoutMIP Using MIP From line 174


               S O L V E      S U M M A R Y

     MODEL   layoutMIP           OBJECTIVE  toth
     TYPE    MIP                 DIRECTION  MINIMIZE
     SOLVER  CONVERT             FROM LINE  174

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.000      1000.000
 ITERATION COUNT, LIMIT         0    2000000000

Convert 2.0      24.7.4 r58773 Released Sep 19, 2016 LEG x86 64bit/Linux      

--- Using Option File
Reading parameter(s) from "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/convert.opt"
>>  ampl tablelayout-scalar.mod
Finished reading from "/home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/convert.opt"
Ampl      : tablelayout-scalar.mod


No solution returned


EXECUTION TIME       =        0.000 SECONDS      2 MB  24.7.4 r58773 LEX-LEG


USER: Remigijus Paulavicius, Single User License     S170731:0859AO-LNX
      Imperial College London, Dept. of Chemical Engineering    DC13449
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      /home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/tablelayout.gms
Output     /home/renigijus/gams/opt-mod-lib/gamslib/tablelayout/tablelayout-scalar.mod.lst
