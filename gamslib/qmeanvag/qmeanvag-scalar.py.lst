GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1  option MIQCP=convert;
   2  option MIQCP=convert;
   3  option MIQCP=convert;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 2
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


   5   
       
      This model is a parallel implementation of the sequential QMEANVAR
      model. Minimum and maximum trade constraints are added to the standard
      mean-variance model. If it is not profitable to trade within these
      ranges, no trade should take place. A turnover constraint is added to
      improve stability of the solution to small changes in data. The
      resulting model is now expressed as a MIQCP and a frontier is
      computed.
       
      Dahl, H, Meeraus, A, and Zenios, S A, Some Financial Optimization
      Models: Risk Management. In Zenios, S A, Ed, Financial Optimization.
      Cambridge University Press, New York, NY, 1993.
       
       
      Two double dash option are used to conveniently change the number of
      points and set a time limit.
  24   
  27   
  32   
  33  scalar maxtime / 120 /
  34   
  35  Set  i  securities  / cn, fr, gr, jp, sw, uk, us /;  alias (i,j) ;
  36   
  37  Parameter  mu(i)  expected return of security /
  38   
  39      cn     0.1287
  40      fr     0.1096
  41      gr     0.0501
  42      jp     0.1524
  43      sw     0.0763
  44      uk     0.1854
  45      us     0.0620 /
  46   
  47   
  48  Table  q(i,j)   covariance matrix
  49   
  50              cn      fr      gr      jp      sw      uk      us
  51      cn    42.18
  52      fr    20.18   70.89
  53      gr    10.88   21.58   25.51
  54      jp     5.30   15.41    9.60   22.33
  55      sw    12.32   23.24   22.63   10.32   30.01
  56      uk    23.84   23.80   13.22   10.46   16.36   42.23
  57      us    17.41   12.62    4.70    1.00    7.20    9.90   16.42 ;
  58   
  59  *  we will continue to use only the lower triangle of the q-matrix
  60  *  and adjust the off diagonal entries to give the correct results.
  61   
  62  q(i,j) = 2*q(j,i) ;  q(i,i) = q(i,i)/2;
  63   
  64   
  65  Scalars  tau   bounding parameter on turnover of current holdings  /0.3 /;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 3
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


  66   
  67  Set pd  portfolio data labels  /
  68            old       current holdings fraction of the portfolio
  69            umin      minimum increase of holdings fraction of security i
  70            umax      maximum increase of holdings fraction of security i
  71            lmin      minimum decrease of holdings fraction of security i
  72            lmax      maximum decrease of holdings fraction of security i  /
  73   
  74   
  75  Table    bdata(i,pd)    portfolio data and trading restrictions
  76  *                    - increase -        - decrease -
  77                old    umin    umax        lmin    lmax
  78          cn    0.2    0.03    0.11        0.02    0.30
  79          fr    0.2    0.04    0.10        0.02    0.15
  80          gr    0.0    0.04    0.07        0.04    0.10
  81          jp    0.0    0.03    0.11        0.04    0.10
  82          sw    0.2    0.03    0.20        0.04    0.10
  83          uk    0.2    0.03    0.10        0.04    0.15
  84          us    0.2    0.03    0.10        0.04    0.30    ;
  85   
  86  bdata(i,'lmax') = min(bdata(i,'old'),bdata(i,'lmax')); ! tighten bounds
  87   
  88  Abort$(abs(sum(i, bdata(i,'old'))-1) >= 1e5) 'error in bdata', bdata;
  89   
  90  Variables
  91      var       variance of portfolio
  92      ret       return of portfolio
  93      x(i)      fraction of portfolio of current holdings of i
  94      xi(i)     fraction of portfolio increase
  95      xd(i)     fraction of portfolio decrease
  96      y(i)      binary switch for increasing current holdings of i
  97      z(i)      binary switch for decreasing current holdings of i
  98   
  99  Binary Variables  y,z; positive variables x, xi, xd;
 100   
 101   
 102  Equations  budget     budget constraint
 103             turnover   restrict maximum turnover of portfolio
 104             maxinc(i)  bound of maximum lot increase of fraction of i
 105             mininc(i)  bound of minimum lot increase of fraction of i
 106             maxdec(i)  bound of maximum lot decrease of fraction of i
 107             mindec(i)  bound of minimum lot decrease of fraction of i
 108             binsum(i)  restrict use of binary variables
 109             xdef(i)    final portfolio definition
 110             retdef     return definition
 111             vardef     variance definition;
 112   
 113  budget..   sum(i, x(i))  =e=  1 ;
 114   
 115  xdef(i)..  x(i) =e= bdata(i,'old') - xd(i) + xi(i);
 116   
 117  maxinc(i)..  xi(i)  =l=  bdata(i,'umax')*y(i) ;
 118  mininc(i)..  xi(i)  =g=  bdata(i,'umin')*y(i) ;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 4
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


 119  maxdec(i)..  xd(i)  =l=  bdata(i,'lmax')*z(i) ;
 120  mindec(i)..  xd(i)  =g=  bdata(i,'lmin')*z(i) ;
 121  binsum(i).. y(i) + z(i) =l= 1;
 122   
 123  turnover.. sum(i, xi(i)) =l=  tau ;
 124   
 125  retdef..  ret =e= sum(i, mu(i)*x(i));
 126   
 127  vardef..  var =e= sum((i,j), x(i)*q(i,j)*x(j));
 128   
 129   
 130   
 131  Models
 132  maxret / budget, xdef, turnover, maxinc, mininc, maxdec, mindec, binsum, retdef /
 133  minvar / budget, xdef, turnover, maxinc, mininc, maxdec, mindec, binsum, retdef, vardef /;
 134   
 135  Set  p       efficient frontier points     / minvar, p1*p4, maxret /
 136       pp(p)   efficient frontier points     /         p1*p4         /
 137   
 138  Scalars     rmin     minimum variance
 139              rmax     maximum variance ;
 140   
 141  Parameter Report(p,i,*)  Portfolio Details at different points
 142            xres(*,p)      Summary report at different points;
 143   
 144  Option limcol=0, limrow=0, solprint=off, optcr=0, solvelink=2, reslim = 120;
 145   
 146  Loop(p('maxret'),
 147     Solve maxret max ret using miqcp ; rmax = ret.l;
 148     xres(i,p)         = x.l(i);
 149     report(p,i,'inc') = xi.l(i);
 150     report(p,i,'dec') = xd.l(i) );
 151   
 152  Loop(p('minvar'),
 153     Solve minvar min var using miqcp ;  rmin = ret.l;
 154     xres(i,p)         = x.l(i);
 155     report(p,i,'inc') = xi.l(i);
 156     report(p,i,'dec') = xd.l(i) );
 157   
 158  parameter h(p) solution handle;
 159   
 160  minvar.solprint=2; minvar.solvelink=3;
 161   
 162  abort$(timeelapsed > maxtime - 5)  "too much time spend for initial solves";
 163  minvar.reslim = maxtime - timeelapsed - 4;
 164   
 165  Loop(pp,
 166     ret.fx = rmin + (rmax-rmin)/(card(pp)+1)*ord(pp) ;
 167     Solve minvar min var using miqcp ;
 168     h(pp) = minvar.handle; );
 169   
 170  Repeat
 171     loop(pp$handlecollect(h(pp)),
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 5
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


 172        if(minvar.solvestat = 1,
 173           xres(i,pp)         = x.l(i);
 174           report(pp,i,'inc') = xi.l(i);
 175           report(pp,i,'dec') = xd.l(i) );
 176        display$handledelete(h(pp)) 'trouble deleting handles' ;
 177        h(pp) = 0 ) ;
 178     display$sleep(card(h)*0.1) 'sleep some time';
 179  until card(h) = 0 or timeelapsed > maxtime;
 180   
 181  xres(i,pp)$h(pp) = na;
 182   
 183  xres('mean',p) = sum(i, mu(i)*xres(i,p));
 184  xres('var' ,p) = sum((i,j), xres(i,p)*q(i,j)*xres(j,p));
 185   
 186  Display$(card(p) < 10) xres, report;
 187   
 188  * prepare gdx data for IDE charting
 189   
 190  execute_unload "qmeanvarg.gdx";


COMPILATION TIME     =        0.001 SECONDS      3 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 6
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Model Statistics    SOLVE maxret Using MIQCP From line 147


MODEL STATISTICS

BLOCKS OF EQUATIONS           9     SINGLE EQUATIONS           45
BLOCKS OF VARIABLES           6     SINGLE VARIABLES           36
NON ZERO ELEMENTS           111     NON LINEAR N-Z              0
DERIVATIVE POOL              20     CONSTANT POOL              16
CODE LENGTH                   0     DISCRETE VARIABLES         14


GENERATION TIME      =        0.001 SECONDS      4 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 7
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Solution Report     SOLVE maxret Using MIQCP From line 147


               S O L V E      S U M M A R Y

     MODEL   maxret              OBJECTIVE  ret
     TYPE    MIQCP               DIRECTION  MAXIMIZE
     SOLVER  CONVERT             FROM LINE  147

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.000       120.000
 ITERATION COUNT, LIMIT         0    2000000000
 EVALUATION ERRORS              0             0

Convert 2.0      24.7.4 r58773 Released Sep 19, 2016 LEG x86 64bit/Linux      

--- Using Option File
Reading parameter(s) from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
>>  pyomo qmeanvag-scalar.py
Finished reading from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
Pyomo     : qmeanvag-scalar.py


No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 8
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Model Statistics    SOLVE minvar Using MIQCP From line 153


MODEL STATISTICS

BLOCKS OF EQUATIONS          10     SINGLE EQUATIONS           46
BLOCKS OF VARIABLES           7     SINGLE VARIABLES           37
NON ZERO ELEMENTS           119     NON LINEAR N-Z              7
DERIVATIVE POOL              20     CONSTANT POOL              43
CODE LENGTH                 115     DISCRETE VARIABLES         14


GENERATION TIME      =        0.039 SECONDS      4 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 9
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Solution Report     SOLVE minvar Using MIQCP From line 153


               S O L V E      S U M M A R Y

     MODEL   minvar              OBJECTIVE  var
     TYPE    MIQCP               DIRECTION  MINIMIZE
     SOLVER  CONVERT             FROM LINE  153

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.000       120.000
 ITERATION COUNT, LIMIT         0    2000000000
 EVALUATION ERRORS              0             0

Convert 2.0      24.7.4 r58773 Released Sep 19, 2016 LEG x86 64bit/Linux      

--- Using Option File
Reading parameter(s) from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
>>  pyomo qmeanvag-scalar.py
Finished reading from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
Pyomo     : qmeanvag-scalar.py


No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                     12/13/18 11:24:35 Page 10
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
E x e c u t i o n


----    178 sleep some time

----    186 PARAMETER xres  Summary report at different points

                      ( ALL       0.000 )


----    186 PARAMETER Report  Portfolio Details at different points

                      ( ALL       0.000 )



EXECUTION TIME       =        0.277 SECONDS      4 MB  24.7.4 r58773 LEX-LEG


USER: Remigijus Paulavicius, Single User License     S170731:0859AO-LNX
      Imperial College London, Dept. of Chemical Engineering    DC13449
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      /home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/qmeanvag.gms
Output     /home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/qmeanvag-scalar.py.lst
