GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1  option MIQCP=convert;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 2
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


   3   
       
      This model is a parallel implementation of the sequential QMEANVAR
      model. Minimum and maximum trade constraints are added to the standard
      mean-variance model. If it is not profitable to trade within these
      ranges, no trade should take place. A turnover constraint is added to
      improve stability of the solution to small changes in data. The
      resulting model is now expressed as a MIQCP and a frontier is
      computed.
       
      Dahl, H, Meeraus, A, and Zenios, S A, Some Financial Optimization
      Models: Risk Management. In Zenios, S A, Ed, Financial Optimization.
      Cambridge University Press, New York, NY, 1993.
       
       
      Two double dash option are used to conveniently change the number of
      points and set a time limit.
  22   
  25   
  30   
  31  scalar maxtime / 120 /
  32   
  33  Set  i  securities  / cn, fr, gr, jp, sw, uk, us /;  alias (i,j) ;
  34   
  35  Parameter  mu(i)  expected return of security /
  36   
  37      cn     0.1287
  38      fr     0.1096
  39      gr     0.0501
  40      jp     0.1524
  41      sw     0.0763
  42      uk     0.1854
  43      us     0.0620 /
  44   
  45   
  46  Table  q(i,j)   covariance matrix
  47   
  48              cn      fr      gr      jp      sw      uk      us
  49      cn    42.18
  50      fr    20.18   70.89
  51      gr    10.88   21.58   25.51
  52      jp     5.30   15.41    9.60   22.33
  53      sw    12.32   23.24   22.63   10.32   30.01
  54      uk    23.84   23.80   13.22   10.46   16.36   42.23
  55      us    17.41   12.62    4.70    1.00    7.20    9.90   16.42 ;
  56   
  57  *  we will continue to use only the lower triangle of the q-matrix
  58  *  and adjust the off diagonal entries to give the correct results.
  59   
  60  q(i,j) = 2*q(j,i) ;  q(i,i) = q(i,i)/2;
  61   
  62   
  63  Scalars  tau   bounding parameter on turnover of current holdings  /0.3 /;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 3
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


  64   
  65  Set pd  portfolio data labels  /
  66            old       current holdings fraction of the portfolio
  67            umin      minimum increase of holdings fraction of security i
  68            umax      maximum increase of holdings fraction of security i
  69            lmin      minimum decrease of holdings fraction of security i
  70            lmax      maximum decrease of holdings fraction of security i  /
  71   
  72   
  73  Table    bdata(i,pd)    portfolio data and trading restrictions
  74  *                    - increase -        - decrease -
  75                old    umin    umax        lmin    lmax
  76          cn    0.2    0.03    0.11        0.02    0.30
  77          fr    0.2    0.04    0.10        0.02    0.15
  78          gr    0.0    0.04    0.07        0.04    0.10
  79          jp    0.0    0.03    0.11        0.04    0.10
  80          sw    0.2    0.03    0.20        0.04    0.10
  81          uk    0.2    0.03    0.10        0.04    0.15
  82          us    0.2    0.03    0.10        0.04    0.30    ;
  83   
  84  bdata(i,'lmax') = min(bdata(i,'old'),bdata(i,'lmax')); ! tighten bounds
  85   
  86  Abort$(abs(sum(i, bdata(i,'old'))-1) >= 1e5) 'error in bdata', bdata;
  87   
  88  Variables
  89      var       variance of portfolio
  90      ret       return of portfolio
  91      x(i)      fraction of portfolio of current holdings of i
  92      xi(i)     fraction of portfolio increase
  93      xd(i)     fraction of portfolio decrease
  94      y(i)      binary switch for increasing current holdings of i
  95      z(i)      binary switch for decreasing current holdings of i
  96   
  97  Binary Variables  y,z; positive variables x, xi, xd;
  98   
  99   
 100  Equations  budget     budget constraint
 101             turnover   restrict maximum turnover of portfolio
 102             maxinc(i)  bound of maximum lot increase of fraction of i
 103             mininc(i)  bound of minimum lot increase of fraction of i
 104             maxdec(i)  bound of maximum lot decrease of fraction of i
 105             mindec(i)  bound of minimum lot decrease of fraction of i
 106             binsum(i)  restrict use of binary variables
 107             xdef(i)    final portfolio definition
 108             retdef     return definition
 109             vardef     variance definition;
 110   
 111  budget..   sum(i, x(i))  =e=  1 ;
 112   
 113  xdef(i)..  x(i) =e= bdata(i,'old') - xd(i) + xi(i);
 114   
 115  maxinc(i)..  xi(i)  =l=  bdata(i,'umax')*y(i) ;
 116  mininc(i)..  xi(i)  =g=  bdata(i,'umin')*y(i) ;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 4
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


 117  maxdec(i)..  xd(i)  =l=  bdata(i,'lmax')*z(i) ;
 118  mindec(i)..  xd(i)  =g=  bdata(i,'lmin')*z(i) ;
 119  binsum(i).. y(i) + z(i) =l= 1;
 120   
 121  turnover.. sum(i, xi(i)) =l=  tau ;
 122   
 123  retdef..  ret =e= sum(i, mu(i)*x(i));
 124   
 125  vardef..  var =e= sum((i,j), x(i)*q(i,j)*x(j));
 126   
 127   
 128   
 129  Models
 130  maxret / budget, xdef, turnover, maxinc, mininc, maxdec, mindec, binsum, retdef /
 131  minvar / budget, xdef, turnover, maxinc, mininc, maxdec, mindec, binsum, retdef, vardef /;
 132   
 133  Set  p       efficient frontier points     / minvar, p1*p4, maxret /
 134       pp(p)   efficient frontier points     /         p1*p4         /
 135   
 136  Scalars     rmin     minimum variance
 137              rmax     maximum variance ;
 138   
 139  Parameter Report(p,i,*)  Portfolio Details at different points
 140            xres(*,p)      Summary report at different points;
 141   
 142  Option limcol=0, limrow=0, solprint=off, optcr=0, solvelink=2, reslim = 120;
 143   
 144  Loop(p('maxret'),
 145     Solve maxret max ret using miqcp ; rmax = ret.l;
 146     xres(i,p)         = x.l(i);
 147     report(p,i,'inc') = xi.l(i);
 148     report(p,i,'dec') = xd.l(i) );
 149   
 150  Loop(p('minvar'),
 151     Solve minvar min var using miqcp ;  rmin = ret.l;
 152     xres(i,p)         = x.l(i);
 153     report(p,i,'inc') = xi.l(i);
 154     report(p,i,'dec') = xd.l(i) );
 155   
 156  parameter h(p) solution handle;
 157   
 158  minvar.solprint=2; minvar.solvelink=3;
 159   
 160  abort$(timeelapsed > maxtime - 5)  "too much time spend for initial solves";
 161  minvar.reslim = maxtime - timeelapsed - 4;
 162   
 163  Loop(pp,
 164     ret.fx = rmin + (rmax-rmin)/(card(pp)+1)*ord(pp) ;
 165     Solve minvar min var using miqcp ;
 166     h(pp) = minvar.handle; );
 167   
 168  Repeat
 169     loop(pp$handlecollect(h(pp)),
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 5
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
C o m p i l a t i o n


 170        if(minvar.solvestat = 1,
 171           xres(i,pp)         = x.l(i);
 172           report(pp,i,'inc') = xi.l(i);
 173           report(pp,i,'dec') = xd.l(i) );
 174        display$handledelete(h(pp)) 'trouble deleting handles' ;
 175        h(pp) = 0 ) ;
 176     display$sleep(card(h)*0.1) 'sleep some time';
 177  until card(h) = 0 or timeelapsed > maxtime;
 178   
 179  xres(i,pp)$h(pp) = na;
 180   
 181  xres('mean',p) = sum(i, mu(i)*xres(i,p));
 182  xres('var' ,p) = sum((i,j), xres(i,p)*q(i,j)*xres(j,p));
 183   
 184  Display$(card(p) < 10) xres, report;
 185   
 186  * prepare gdx data for IDE charting
 187   
 188  execute_unload "qmeanvarg.gdx";


COMPILATION TIME     =        0.002 SECONDS      3 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 6
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Model Statistics    SOLVE maxret Using MIQCP From line 145


MODEL STATISTICS

BLOCKS OF EQUATIONS           9     SINGLE EQUATIONS           45
BLOCKS OF VARIABLES           6     SINGLE VARIABLES           36
NON ZERO ELEMENTS           111     NON LINEAR N-Z              0
DERIVATIVE POOL              20     CONSTANT POOL              16
CODE LENGTH                   0     DISCRETE VARIABLES         14


GENERATION TIME      =        0.003 SECONDS      4 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 7
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Solution Report     SOLVE maxret Using MIQCP From line 145


               S O L V E      S U M M A R Y

     MODEL   maxret              OBJECTIVE  ret
     TYPE    MIQCP               DIRECTION  MAXIMIZE
     SOLVER  CONVERT             FROM LINE  145

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.000       120.000
 ITERATION COUNT, LIMIT         0    2000000000
 EVALUATION ERRORS              0             0

Convert 2.0      24.7.4 r58773 Released Sep 19, 2016 LEG x86 64bit/Linux      

--- Using Option File
Reading parameter(s) from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
>>  ampl qmeanvag-scalar.mod
Finished reading from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
Ampl      : qmeanvag-scalar.mod


No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 8
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Model Statistics    SOLVE minvar Using MIQCP From line 151


MODEL STATISTICS

BLOCKS OF EQUATIONS          10     SINGLE EQUATIONS           46
BLOCKS OF VARIABLES           7     SINGLE VARIABLES           37
NON ZERO ELEMENTS           119     NON LINEAR N-Z              7
DERIVATIVE POOL              20     CONSTANT POOL              43
CODE LENGTH                 115     DISCRETE VARIABLES         14


GENERATION TIME      =        0.001 SECONDS      4 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:24:35 Page 9
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
Solution Report     SOLVE minvar Using MIQCP From line 151


               S O L V E      S U M M A R Y

     MODEL   minvar              OBJECTIVE  var
     TYPE    MIQCP               DIRECTION  MINIMIZE
     SOLVER  CONVERT             FROM LINE  151

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.000       120.000
 ITERATION COUNT, LIMIT         0    2000000000
 EVALUATION ERRORS              0             0

Convert 2.0      24.7.4 r58773 Released Sep 19, 2016 LEG x86 64bit/Linux      

--- Using Option File
Reading parameter(s) from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
>>  ampl qmeanvag-scalar.mod
Finished reading from "/home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/convert.opt"
Ampl      : qmeanvag-scalar.mod


No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                     12/13/18 11:24:35 Page 10
Portfolio Modeling with Parallel Solutions (QMEANVAG,SEQ=327)
E x e c u t i o n


----    176 sleep some time

----    184 PARAMETER xres  Summary report at different points

                      ( ALL       0.000 )


----    184 PARAMETER Report  Portfolio Details at different points

                      ( ALL       0.000 )



EXECUTION TIME       =        0.333 SECONDS      4 MB  24.7.4 r58773 LEX-LEG


USER: Remigijus Paulavicius, Single User License     S170731:0859AO-LNX
      Imperial College London, Dept. of Chemical Engineering    DC13449
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      /home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/qmeanvag.gms
Output     /home/renigijus/gams/opt-mod-lib/gamslib/qmeanvag/qmeanvag-scalar.mod.lst
