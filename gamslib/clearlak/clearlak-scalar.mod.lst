GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1  option LP=convert;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 2
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
C o m p i l a t i o n


   3   
       
      Exercise, p. 44:
       
      The Clear Lake Dam controls the water level in Clear Lake, a
      well-known resort in Dreamland.  The Dam Commission is trying to
      decide how much water to release in each of the next four months.
      The Lake is currently 150 mm below flood stage.  The dam is capable
      of lowering the water level 200 mm each month, but additional
      precipitation and evaporation affect the dam.  The weather near Clear
      Lake is highly variable.  The Dam Commission has divided the months
      into two two-month blocks of similar weather.  The months within each
      block have the same probabilities for weather, which are assumed
      independent of one another.  In each month of the first block, they
      assign a probability of 1/2 to having a natural 100-mm increase in
      water levels and probabilities of 1/4 to having a 50-mm decrease or a
      250-mm increase in water levels.  All these figures correspond to
      natural changes in water level without dam releases.  In each month
      of the second block, they assign a probability of 1/2 to having a
      natural 150-mm increase in water levels and probabilities of 1/4 to
      having a 50-mm increase or a 350-mm increase in water levels.  If a
      flood occurs, then damage is assessed at $10,000 per mm above flood
      level.  A water level too low leads to costly importation of water.
      These costs are $5000 per mm less than 250 mm below flood stage.  The
      commission first considers an overall goal of minimizing expected
      costs.  This model only considers this first objective.
       
       
      Birge, R, and Louveaux, F V, Introduction to Stochastic Programming.
      Springer, 1997.
       
  36   
  37   
  38  SET     p       Precipitation levels in each month /low, normal, high/
  39          t       Time periods /dec,jan,feb,mar,apr/
  40          baset(t) / dec /
  41          w       Weather conditions /wet, dry/;
  42  SET     tw(t,w)        relates months to weather conditions /
  43                  (jan,feb).wet
  44                  (mar,apr).dry
  45                  /;
  46   
  47  SET     n       nodes / n1 * n121 /;
  48  ALIAS   (n,parent,child);
  49  SET     root(n)        root node / n1 /
  50          tn(t,n) map nodes to time periods
  51          anc(child,parent) ancestor mapping
  52          np(n,p)           maps nodes to precipitation level
  53          leaf(n);
  54   
  55  np(n,p)$[mod(ord(n)-2,card(p)) eq ord(p)-1] = yes;
  56  np(root,p) = no;
  57  * display np;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 3
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
C o m p i l a t i o n


  58   
  59  scalar tmp1, tmp2;
  60  tmp1 = 0;
  61  loop {t,
  62      tmp2 = (power[card(p), ord(t)]) / (card(p)-1);
  63      tn(t,n)$[ord(n) ge tmp1  and  ord(n) lt tmp2] = yes;
  64      tmp1 = tmp2;
  65  };
  66  * display tn;
  67  anc(child,parent)$[floor((ord(child)+1)/card(p)) eq ord(parent)] = yes;
  68  * display anc;
  69  leaf(n)$[ord(n) gt (power[card(p), card(t)-1] - 1) / (card(p)-1)] =  yes;
  70  * display leaf;
  71   
  72  TABLE  delta(w,p)  Changes in reservoir level for each season
  73                          low     normal  high
  74                  dry     -50     100     250
  75                  wet     50      150     350     ;
  76   
  77  PARAMETER       pr(p)  Probability distribution /
  78  low     0.25,
  79  normal         0.50,
  80  high    0.25
  81  /;
  82   
  83  PARAMETER nprob(n)      probability of being at any node;
  84  nprob(root) = 1;
  85  loop {anc(child,parent),
  86      nprob(child) = sum {np(child,p), pr(p)} * nprob(parent);
  87  };
  88  * display nprob;
  89   
  90  * ndelta required for current scenRed implementation
  91  PARAMETER ndelta(n)     water delta at each node;
  92  ndelta(n) = sum {(tw(t,w), np(n,p))$[tn(t,n)], delta(w,p)};
  93  * display ndelta;
  94   
  95  tmp1 = sum {leaf, nprob(leaf)};
  96  abort$[abs(tmp1-1) gt 1e-8] "Error in tree: leaf probabilities do not sum to 1";
  97   
  98   
  99  SCALAR floodCost        'K$/mm for amounts over flood level' / 10 /;
 100  SCALAR lowCost          'K$/mm for amounts 250mm below flood level' / 5 /;
 101  SCALAR l0               'initial water level' /100/;
 102   
 103  VARIABLE                ec      'Expected value of cost';
 104  POSITIVE VARIABLE       l(t,n)  'level of water in dam, EOP'
 105                          r(t,n)  'mm released normally'
 106                          f(t,n)  'mm of floodwater released'
 107                          z(t,n)  'mm of water imported';
 108   
 109  r.up(t,n) = 200;
 110  * water level l is relative to 250mm below flood stage
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 4
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
C o m p i l a t i o n


 111  l.up(t,n) = 250;
 112  l.fx(baset,n) = l0;
 113   
 114  SET     nn(n)              nodes in reduced tree
 115          sanc(child,parent) ancestor mapping for reduced tree
 116          canc(child,parent) computed ancestor mapping for reduced tree;
 117  PARAMETER snprob(n)        probabilities for reduced tree;
 118   
 119  EQUATIONS               ecdef, ldef(t,n);
 120   
 121  ecdef..         ec =e= sum {tn(t,nn), snprob(nn) *
 122                               [floodCost * f(t,nn) + lowCost * z(t,nn)]};
 123   
 124  ldef(tn(t,nn))$[not root(nn)]..
 125                  l(t,nn) =e= sum {anc(nn,parent), l(t-1,parent)}
 126                           + ndelta(nn) + z(t,nn)
 127                           - r(t,nn) - f(t,nn);
 128   
 129  model mincost / ecdef, ldef /;
 130   
 132   
 133  * now let's shrink the node set
LIBINCLUDE /opt/gams/gams24.7_linux_x64_64_sfx/inclib/scenred.gms
 135  SET SR_Parms 'ScenRed input parameters' /
 136  num_time_steps  'path length from root to leaf'
 137  num_leaves      'leaves/scenarios in the initial tree'
 138  num_nodes       'nodes in the initial tree'
 139  num_random      'random variables assigned to a scenario or node'
 140  red_num_leaves  'desired number of preserved scenarios or leaves'
 141  red_percentage  'desired relative distance from initial to reduced tree'
 142  where_random    '100*inObj + 10*inRHS + inMatrix'
 143  reduction_method 'desired method'
 144  num_stages      'branching levels ???'
 145  run_time_limit  'in seconds'
 146  report_level    '0-default, 1-additional log info'
 147  /;
 148   
 149  SET SR_Stats 'ScenRed output statistics' /
 150  ScenRedWarnings
 151  ScenRedErrors
 152  run_time        'in seconds'
 153  orig_nodes      'nodes in the initial tree'
 154  orig_leaves     'leaves/scenarios in the initial tree'
 155  red_nodes       'nodes in the reduced tree'
 156  red_leaves      'leaves/scenarios in the reduced tree'
 157  red_percentage  'relative distance from initial to reduced tree'
 158  red_absolute    'absolute distance from initial to reduced tree'
 159  reduction_method 'method used'
 160  /;
 161   
 162  PARAMETER ScenRedParms (SR_Parms);
 163  PARAMETER ScenRedReport(SR_Stats);
 164   
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 5
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
C o m p i l a t i o n


 165  ScenRedParms('num_leaves') =  sum {leaf, 1};
 166  ScenRedParms('num_random') = 1;
 167  ScenRedParms('num_nodes') = card(n);
 168  ScenRedParms('num_time_steps') = card(t);
 169  * typically, one of the following two parameters is set
 170  ScenRedParms('red_percentage') = 0.5;
 171   
 172  * optional SCENRED input parameters: defaults are commented
 173  * ScenRedParms('num_stages') = ScenRedParms('num_time_steps');
 174  * ScenRedParms('reduction_method') = 0;
 175  * ScenRedParms('where_random') = 10;
 176  * ScenRedParms('report_level') = 0;
 177  ScenRedParms('run_time_limit') = 60;
 178   
 179  execute_unload 'lakein.gdx',  ScenRedParms, n, anc, nprob, ndelta;
 180  execute 'rm -f lakeout.gdx';
 181  file opts / 'scenred.opt' /;
 182  putclose opts   'log_file =    lakelog.txt'
 183                / 'input_gdx     lakein.gdx'
 184                / 'output_gdx =  lakeout.gdx';
 185  execute 'scenred scenred.opt  >> "/home/renigijus/gams/opt-mod-lib/gamslib/clearlak/ampl-convert.log"';
 186  execute_load   'lakeout.gdx', ScenRedReport, snprob=red_prob,
 187                                sanc=red_ancestor;
 188  display ScenRedReport;
 189  display snprob;
 190   
 191  nn(n) = snprob(n);
 192  display nn;
 193   
 194   
 195  * -- BEGIN consistency check of output -- *
 196  canc(anc(child,parent))$[nn(child)] = YES;
 197  display canc, sanc;
 198   
 199  SET     chk(child,parent);
 200  chk(child,parent) = NO;
 201  chk(canc(child,parent)) = YES;
 202  chk(sanc(child,parent)) = NO;
 203  abort$[sum{chk, 1}] "Error in reduced tree: inconsistent output", chk;
 204   
 205  chk(sanc(child,parent)) = YES;
 206  chk(canc(child,parent)) = NO;
 207  abort$[sum{chk, 1}] "Error in reduced tree: inconsistent output", chk;
 208   
 209  tmp1 = sum {leaf(nn), snprob(leaf)} - 1;
 210  abort$[abs(tmp1) gt 1e-8]
 211   "Error in tree: leaf probabilities do not sum to 1", tmp1;
 212  * -- END consistency check of output -- *
 213   
 215   
 216  solve mincost using lp min ec;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 6
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  /home/renigijus/gams/opt-mod-lib/gamslib/clearlak/clearlak.gms
     2      134 LIBINCLUDE     1     134  ./opt/gams/gams24.7_linux_x64_64_sfx/inclib/scenred.gms


COMPILATION TIME     =        0.002 SECONDS      3 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 7
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
E x e c u t i o n


----    188 PARAMETER ScenRedReport  

red_percentage       0.524,    reduction_method     2.000,    ScenRedWarnings      1.000,    orig_nodes         121.000,    orig_leaves         81.000,    red_nodes           23.000,    red_leaves          10.000,    red_absolute     24444.181


----    189 PARAMETER snprob  probabilities for reduced tree

n1   1.000,    n3   0.750,    n4   0.250,    n9   0.562,    n10  0.187,    n12  0.187,    n13  0.062,    n26  0.141,    n27  0.281,    n28  0.141,    n30  0.187,    n36  0.187,    n39  0.062,    n78  0.141,    n80  0.070,    n81  0.141,    n82  0.070
n84  0.141,    n89  0.047,    n90  0.094,    n91  0.047,    n108 0.187,    n117 0.062


----    192 SET nn  nodes in reduced tree

n1  ,    n3  ,    n4  ,    n9  ,    n10 ,    n12 ,    n13 ,    n26 ,    n27 ,    n28 ,    n30 ,    n36 ,    n39 ,    n78 ,    n80 ,    n81 ,    n82 ,    n84 ,    n89 ,    n90 ,    n91 ,    n108,    n117


----    197 SET canc  computed ancestor mapping for reduced tree

              n1          n3          n4          n9         n10         n12         n13         n26         n27         n28         n30         n36         n39

n3           YES
n4           YES
n9                       YES
n10                      YES
n12                                  YES
n13                                  YES
n26                                              YES
n27                                              YES
n28                                              YES
n30                                                          YES
n36                                                                      YES
n39                                                                                  YES
n78                                                                                              YES
n80                                                                                                          YES
n81                                                                                                          YES
n82                                                                                                          YES
n84                                                                                                                      YES
n89                                                                                                                                  YES
n90                                                                                                                                  YES
n91                                                                                                                                  YES
n108                                                                                                                                             YES
n117                                                                                                                                                         YES


----    197 SET sanc  ancestor mapping for reduced tree

              n1          n3          n4          n9         n10         n12         n13         n26         n27         n28         n30         n36         n39

n3           YES
n4           YES
n9                       YES
n10                      YES
n12                                  YES
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 8
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
E x e c u t i o n


        197 SET sanc  ancestor mapping for reduced tree

              n1          n3          n4          n9         n10         n12         n13         n26         n27         n28         n30         n36         n39

n13                                  YES
n26                                              YES
n27                                              YES
n28                                              YES
n30                                                          YES
n36                                                                      YES
n39                                                                                  YES
n78                                                                                              YES
n80                                                                                                          YES
n81                                                                                                          YES
n82                                                                                                          YES
n84                                                                                                                      YES
n89                                                                                                                                  YES
n90                                                                                                                                  YES
n91                                                                                                                                  YES
n108                                                                                                                                             YES
n117                                                                                                                                                         YES

GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:22:39 Page 9
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
Equation Listing    SOLVE mincost Using LP From line 216


---- ecdef  =E=  

ecdef..  ec - 10*f(dec,n1) - 7.5*f(jan,n3) - 2.5*f(jan,n4) - 5.625*f(feb,n9) - 1.875*f(feb,n10) - 1.875*f(feb,n12) - 0.625*f(feb,n13) - 1.40625*f(mar,n26) - 2.8125*f(mar,n27) - 1.40625*f(mar,n28) - 1.875*f(mar,n30) - 1.875*f(mar,n36) - 0.625*f(mar,n39)
     
      - 1.40625*f(apr,n78) - 0.703125*f(apr,n80) - 1.40625*f(apr,n81) - 0.703125*f(apr,n82) - 1.40625*f(apr,n84) - 0.46875*f(apr,n89) - 0.9375*f(apr,n90) - 0.46875*f(apr,n91) - 1.875*f(apr,n108) - 0.625*f(apr,n117) - 5*z(dec,n1) - 3.75*z(jan,n3)
     
      - 1.25*z(jan,n4) - 2.8125*z(feb,n9) - 0.9375*z(feb,n10) - 0.9375*z(feb,n12) - 0.3125*z(feb,n13) - 0.703125*z(mar,n26) - 1.40625*z(mar,n27) - 0.703125*z(mar,n28) - 0.9375*z(mar,n30) - 0.9375*z(mar,n36) - 0.3125*z(mar,n39) - 0.703125*z(apr,n78)
     
      - 0.3515625*z(apr,n80) - 0.703125*z(apr,n81) - 0.3515625*z(apr,n82) - 0.703125*z(apr,n84) - 0.234375*z(apr,n89) - 0.46875*z(apr,n90) - 0.234375*z(apr,n91) - 0.9375*z(apr,n108) - 0.3125*z(apr,n117) =E= 0 ; (LHS = 0)
     

---- ldef  =E=  

ldef(jan,n3)..  - l(dec,n1) + l(jan,n3) + r(jan,n3) + f(jan,n3) - z(jan,n3) =E= 150 ; (LHS = -100, INFES = 250 ****)
     
ldef(jan,n4)..  - l(dec,n1) + l(jan,n4) + r(jan,n4) + f(jan,n4) - z(jan,n4) =E= 350 ; (LHS = -100, INFES = 450 ****)
     
ldef(feb,n9)..  - l(jan,n3) + l(feb,n9) + r(feb,n9) + f(feb,n9) - z(feb,n9) =E= 150 ; (LHS = 0, INFES = 150 ****)
     
REMAINING 19 ENTRIES SKIPPED

GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                     12/13/18 11:22:39 Page 10
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
Column Listing      SOLVE mincost Using LP From line 216


---- ec  Expected value of cost

ec
                (.LO, .L, .UP, .M = -INF, 0, +INF, 0)
        1       ecdef


---- l  level of water in dam, EOP

l(dec,n1)
                (.LO, .L, .UP, .M = 100, 100, 100, 0)
       -1       ldef(jan,n3)
       -1       ldef(jan,n4)

l(jan,n3)
                (.LO, .L, .UP, .M = 0, 0, 250, 0)
        1       ldef(jan,n3)
       -1       ldef(feb,n9)
       -1       ldef(feb,n10)

l(jan,n4)
                (.LO, .L, .UP, .M = 0, 0, 250, 0)
        1       ldef(jan,n4)
       -1       ldef(feb,n12)
       -1       ldef(feb,n13)

REMAINING 20 ENTRIES SKIPPED

---- r  mm released normally

r(jan,n3)
                (.LO, .L, .UP, .M = 0, 0, 200, 0)
        1       ldef(jan,n3)

r(jan,n4)
                (.LO, .L, .UP, .M = 0, 0, 200, 0)
        1       ldef(jan,n4)

r(feb,n9)
                (.LO, .L, .UP, .M = 0, 0, 200, 0)
        1       ldef(feb,n9)

REMAINING 19 ENTRIES SKIPPED

---- f  mm of floodwater released

f(dec,n1)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
      -10       ecdef

f(jan,n3)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
       -7.5     ecdef
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                     12/13/18 11:22:39 Page 11
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
Column Listing      SOLVE mincost Using LP From line 216


     f  mm of floodwater released

        1       ldef(jan,n3)

f(jan,n4)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
       -2.5     ecdef
        1       ldef(jan,n4)

REMAINING 20 ENTRIES SKIPPED

---- z  mm of water imported

z(dec,n1)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
       -5       ecdef

z(jan,n3)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
       -3.75    ecdef
       -1       ldef(jan,n3)

z(jan,n4)
                (.LO, .L, .UP, .M = 0, 0, +INF, 0)
       -1.25    ecdef
       -1       ldef(jan,n4)

REMAINING 20 ENTRIES SKIPPED
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                     12/13/18 11:22:39 Page 12
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
Model Statistics    SOLVE mincost Using LP From line 216


MODEL STATISTICS

BLOCKS OF EQUATIONS           2     SINGLE EQUATIONS           23
BLOCKS OF VARIABLES           5     SINGLE VARIABLES           92
NON ZERO ELEMENTS           157


GENERATION TIME      =        0.001 SECONDS      4 MB  24.7.4 r58773 LEX-LEG


EXECUTION TIME       =        0.043 SECONDS      4 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                     12/13/18 11:22:39 Page 13
Scenario Reduction: ClearLake exercise (CLEARLAK,SEQ=249)
Solution Report     SOLVE mincost Using LP From line 216


               S O L V E      S U M M A R Y

     MODEL   mincost             OBJECTIVE  ec
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CONVERT             FROM LINE  216

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.000      1000.000
 ITERATION COUNT, LIMIT         0    2000000000

Convert 2.0      24.7.4 r58773 Released Sep 19, 2016 LEG x86 64bit/Linux      

--- Using Option File
Reading parameter(s) from "/home/renigijus/gams/opt-mod-lib/gamslib/clearlak/convert.opt"
>>  ampl clearlak-scalar.mod
Finished reading from "/home/renigijus/gams/opt-mod-lib/gamslib/clearlak/convert.opt"
Ampl      : clearlak-scalar.mod


No solution returned

**** REPORT FILE SUMMARY

opts /home/renigijus/gams/opt-mod-lib/gamslib/clearlak/scenred.opt


EXECUTION TIME       =        0.000 SECONDS      2 MB  24.7.4 r58773 LEX-LEG


USER: Remigijus Paulavicius, Single User License     S170731:0859AO-LNX
      Imperial College London, Dept. of Chemical Engineering    DC13449
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      /home/renigijus/gams/opt-mod-lib/gamslib/clearlak/clearlak.gms
Output     /home/renigijus/gams/opt-mod-lib/gamslib/clearlak/clearlak-scalar.mod.lst
