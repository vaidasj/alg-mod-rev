GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:30:37 Page 1
A wrapper for the COIN-OR Semidefinite Programming Solver CSDP
C o m p i l a t i o n


   2   
   3  Set m, n, mLE(m), mGE(m); alias (n,i,j);
   4  Parameter
   5  * Input
   6      c(m)      cost coefficients
   7      F(m,i,j)  constraint matrix
   8      F0(i,j)   constant term
   9  * Output
  10      xvec(m)   variable vector
  11      X(i,j)    variable matrix
  12      Y(i,j)    dual matrix;
  13   
  14   
  17   
  18  set s order;
  19   
  21   
GDXIN   /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/csdpin.gdx
--- LOAD  n = 1:n
--- LOAD  m = 2:m
--- LOAD  c = 4:c
--- LOAD  F = 5:F
--- LOAD  F0 = 6:F0
  24   
--- LOAD  mLE = 3:mLE
  28  $load mGE
****          $492
**** LINE     32 INPUT       /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/runcsdp.inc
  30  $clearerror
****            $576
**** LINE     34 INPUT       /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/runcsdp.inc
  31  mGE(m) = no;
  33   
  34  Set upper(i,j), lower(i,j);
  35  upper(i,j)$(ord(i)<=ord(j)) = yes;
  36  lower(i,j)$(ord(i) >ord(j)) = yes;
  37   
  38  * Assumption: We get permuted upper triangular matrices F and F0
  39  Set errorF0(i,j), errorF(m,i,j);
  40   
  41  errorF0(lower(i,j)) = F0(i,j) and F0(j,i);
  42  abort$card(errorF0) 'F0 not permuted upper triangular', errorF0;
  43   
  44  errorF(m,lower(i,j)) = F(m,i,j) and F(m,j,i);
  45  abort$card(errorF) 'F not permuted upper triangular', errorF;
  46   
  47  * Make them all upper
  48  F0(i,j)$lower(j,i)  $= F0(j,i);  F0(lower) = 0;
  49  F(m,i,j)$lower(j,i) $= F(m,j,i); F(m,lower) = 0;
  50   
      $load Y
      Parameter rep;
      rep(m,'lhs')  = sum(lower(j,i), 2*F(m,i,j)*Y(j,i)) + sum(i,F(m,i,i)*Y(i,i));
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:30:37 Page 2
A wrapper for the COIN-OR Semidefinite Programming Solver CSDP
C o m p i l a t i o n


      rep(m,'rhs')  = c(m);
      rep(m,'diff') = rep(m,'lhs') - rep(m,'rhs');
      display rep;
      $exit
  60   
  61  file CSDPin / csdp.in /; CSDPin.nw=0; CSDPin.nd=0; CSDPin.pw=100;
  62  put CSDPin card(m):0:0 ' =mdim'/ (1+1$(card(mLE) + card(mGE))):0 ' =nblocks' / '{' card(n):0:0
  63  put$(card(mLE) + card(mGE)) ', -' (card(mLE) + card(mGE)):0:0
  64  put '}' /;
  65  loop(m, put$(CSDPin.cc > CSDPin.pw-20) '&' /; put c(m)::15 ' ' );
  66   
  67  * F0(i,j)
  68  loop(upper(i,j)$F0(i,j),
  69    put / '0 1 ' i.ord ' ' j.ord ' ' F0(i,j)::15 );
  70   
  71  * F(m,i,j)
  72  scalar slackID /0/;
  73  loop(m,
  74    loop(upper(i,j)$F(m,i,j),
  75      put / m.ord ' 1 ' i.ord ' ' j.ord ' ' F(m,i,j)::15 );
  76    if ((mLE(m) or mGE(m)),
  77      slackID=slackID+1;
  78      put$mLE(m) / m.ord ' 2 ' slackID:0:0 ' ' slackID:0:0 '  1.0';
  79      put$mGE(m) / m.ord ' 2 ' slackID:0:0 ' ' slackID:0:0 ' -1.0' ));
  80  putclose;
  81   
  82  * AWK script to concatenate lines that end with a "&"
  87   
  88  * AWK Script to produce a GAMS readable SDP solution file
  89  * We skip the slack variables for the inequality constraints
  99   
 101  execute 'awk -f concat.awk csdp.in > csdpX.in && csdp csdpX.in csdp.out';
 102  abort$(errorlevel <> 0 and errorlevel <> 3) 'Problems running csdp';
 103  execute 'awk -f csdp2gms.awk csdp.out > csdpO.gms && gams csdpO lo=2 gdx=csdpO.gdx';
 104  abort$errorlevel 'Problems running csdp';
 105   
 108  set n_ / sdpn1*sdpn51 /
 109      m_ / sdpm1*sdpm103 /
 110  * nn_ is really big
 111      nn_(n,n_) /#n:#n_/, nn_2(n,n_), mm_(m,m_) /#m:#m_/; nn_2(nn_) = yes;
 112  Alias (n_, i_, j_);
 113   
 114  * SDP solution comes back as a full matrix
 115  Parameter
 116      xvec_(m_)  variable vector
 117      X_(n_,n_)  variable matrix
 118      Y_(n_,n_)  dual matrix;
 119   
 120  execute_load 'csdpO.gdx', xvec_, X_, Y_;
 121  xvec(m) = sum(mm_(m,m_), xvec_(m_));
 122  X(i,j)  = sum((nn_(i,i_),nn_2(j,j_)), X_(i_,j_)); X(i,j)$(ord(i)>ord(j)) = X(j,i);
 123  Y(i,j)  = sum((nn_(i,i_),nn_2(j,j_)), Y_(i_,j_)); Y(i,j)$(ord(i)>ord(j)) = Y(j,i);
 124   
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:30:37 Page 3
A wrapper for the COIN-OR Semidefinite Programming Solver CSDP
C o m p i l a t i o n


 125  execute_unload 'csdpout', xvec, X, Y, n, m;
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:30:37 Page 4
A wrapper for the COIN-OR Semidefinite Programming Solver CSDP
Error Messages


492  Symbol not in GDX
576  Errors have been cleared and made into warnings
       execution of this program may fail in unpredictable ways

**** 0 ERROR(S)   2 WARNING(S)
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:30:37 Page 5
A wrapper for the COIN-OR Semidefinite Programming Solver CSDP
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/runcsdp.inc
     2       22 GDXIN          1      22  /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/csdpin.gdx
     3      100 CALL           1     104  rm -f csdp.out csdpO.gms


COMPILATION TIME     =        0.009 SECONDS      3 MB  24.7.4 r58773 LEX-LEG
GAMS 24.7.4  r58773 Released Sep 19, 2016 LEX-LEG x86 64bit/Linux                                                                                                                                                                      12/13/18 11:30:37 Page 6
A wrapper for the COIN-OR Semidefinite Programming Solver CSDP
E x e c u t i o n


**** REPORT FILE SUMMARY

CSDPin /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/csdp.in


EXECUTION TIME       =        0.139 SECONDS      5 MB  24.7.4 r58773 LEX-LEG


USER: Remigijus Paulavicius, Single User License     S170731:0859AO-LNX
      Imperial College London, Dept. of Chemical Engineering    DC13449
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/runcsdp.inc
Output     /home/renigijus/gams/opt-mod-lib/gamslib/kqkpsdp/runcsdp.lst
